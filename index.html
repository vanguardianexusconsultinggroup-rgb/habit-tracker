<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mi Habit Tracker</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0f172a;
      color: #e5e7eb;
      margin: 0;
      padding: 24px;
    }
    h1 {
      text-align: center;
      margin-bottom: 16px;
    }
    .container {
      max-width: 900px;
      margin: 0 auto;
      background: #020617;
      padding: 20px;
      border-radius: 16px;
      border: 1px solid #1f2937;
      box-shadow: 0 20px 40px rgba(0,0,0,0.4);
    }
    .add-row {
      display: flex;
      gap: 8px;
      margin-bottom: 16px;
      flex-wrap: wrap;
    }
    .add-row input {
      flex: 1;
      min-width: 200px;
      padding: 8px 10px;
      border-radius: 8px;
      border: 1px solid #4b5563;
      background: #020617;
      color: #e5e7eb;
    }
    .add-row button {
      padding: 8px 14px;
      border-radius: 8px;
      border: none;
      background: #6366f1;
      color: white;
      cursor: pointer;
      font-weight: 600;
      white-space: nowrap;
    }
    table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
    }
    th, td {
      border: 1px solid #1f2937;
      padding: 6px;
      text-align: center;
    }
    th {
      background: #111827;
      position: sticky;
      top: 0;
      z-index: 1;
    }
    td:first-child, th:first-child {
      text-align: left;
      min-width: 160px;
    }
    input[type="checkbox"] {
      width: 16px;
      height: 16px;
      cursor: pointer;
    }
    .delete-btn {
      background: #b91c1c;
      border: none;
      color: white;
      padding: 4px 8px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }
    .progress-cell {
      min-width: 70px;
    }
    @media (max-width: 700px) {
      body {
        padding: 12px;
      }
      table {
        font-size: 12px;
      }
      td:first-child, th:first-child {
        min-width: 120px;
      }
    }
  </style>
</head>
<body>
  <h1>✨ Mi Habit Tracker</h1>
  <div class="container">
    <p style="margin-top:0; margin-bottom:12px; color:#9ca3af; font-size:14px;">
      Tus datos se guardan automáticamente en este dispositivo (navegador). 
      Si abrís este link en otra compu o borrás los datos del navegador, se reinicia.
    </p>

    <div class="add-row">
      <input id="habit-name" type="text" placeholder="Nuevo hábito (ej: Leer 20 min)" />
      <button onclick="addHabit()">Añadir</button>
    </div>

    <table id="habit-table">
      <thead>
        <tr>
          <th>Hábito</th>
          <th>Lun</th>
          <th>Mar</th>
          <th>Mié</th>
          <th>Jue</th>
          <th>Vie</th>
          <th>Sáb</th>
          <th>Dom</th>
          <th>Progreso</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        <!-- Filas se generan con JS -->
      </tbody>
    </table>
  </div>

  <script>
    const STORAGE_KEY = "habit-tracker-data-v1";
    const tbody = document.querySelector("#habit-table tbody");

    // Cargar datos guardados o usar iniciales
    function loadHabits() {
      try {
        const saved = localStorage.getItem(STORAGE_KEY);
        if (saved) {
          return JSON.parse(saved);
        }
      } catch (e) {
        console.error("Error leyendo localStorage", e);
      }
      return [
        { name: "Beber 2L de agua", days: [false, false, false, false, false, false, false] },
        { name: "Leer 20 minutos",    days: [false, false, false, false, false, false, false] },
        { name: "Hacer ejercicio",    days: [false, false, false, false, false, false, false] },
      ];
    }

    function saveHabits(habits) {
      try {
        localStorage.setItem(STORAGE_KEY, JSON.stringify(habits));
      } catch (e) {
        console.error("Error guardando en localStorage", e);
      }
    }

    let habits = loadHabits();

    function getCurrentHabitsFromTable() {
      const rows = Array.from(tbody.querySelectorAll("tr"));
      return rows.map(row => {
        const name = row.querySelector(".habit-name").textContent;
        const checkboxes = row.querySelectorAll('input[type="checkbox"]');
        const days = Array.from(checkboxes).map(c => c.checked);
        return { name, days };
      });
    }

    function createRow(habit) {
      const tr = document.createElement("tr");

      const nameTd = document.createElement("td");
      nameTd.textContent = habit.name;
      nameTd.className = "habit-name";
      tr.appendChild(nameTd);

      for (let i = 0; i < 7; i++) {
        const td = document.createElement("td");
        const checkbox = document.createElement("input");
        checkbox.type = "checkbox";
        checkbox.checked = habit.days[i] || false;
        checkbox.addEventListener("change", () => {
          updateProgressForRow(tr);
          habits = getCurrentHabitsFromTable();
          saveHabits(habits);
        });
        td.appendChild(checkbox);
        tr.appendChild(td);
      }

      const progressTd = document.createElement("td");
      progressTd.className = "progress-cell";
      tr.appendChild(progressTd);

      const deleteTd = document.createElement("td");
      const deleteBtn = document.createElement("button");
      deleteBtn.textContent = "✕";
      deleteBtn.className = "delete-btn";
      deleteBtn.onclick = () => {
        tr.remove();
        habits = getCurrentHabitsFromTable();
        saveHabits(habits);
      };
      deleteTd.appendChild(deleteBtn);
      tr.appendChild(deleteTd);

      updateProgressForRow(tr);
      return tr;
    }

    function updateProgressForRow(row) {
      const checkboxes = row.querySelectorAll('input[type="checkbox"]');
      const checked = Array.from(checkboxes).filter(c => c.checked).length;
      const percent = Math.round((checked / 7) * 100);
      const progressCell = row.querySelector(".progress-cell");
      progressCell.textContent = percent + "%";
    }

    function renderHabits() {
      tbody.innerHTML = "";
      habits.forEach(h => tbody.appendChild(createRow(h)));
    }

    function addHabit() {
      const input = document.getElementById("habit-name");
      const name = input.value.trim();
      if (!name) return;
      const newHabit = { name, days: [false, false, false, false, false, false, false] };
      habits.push(newHabit);
      saveHabits(habits);
      renderHabits();
      input.value = "";
    }

    // Inicial
    renderHabits();
  </script>
</body>
</html>
